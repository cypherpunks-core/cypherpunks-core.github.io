<!-- Google Analytics - Deferred Loading for Performance -->
<script>
  // Defer GA loading until after page is interactive
  window.addEventListener('load', function() {
    // Respect Do Not Track
    if (window.doNotTrack === "1" || navigator.doNotTrack === "1" || navigator.doNotTrack === "yes" || navigator.msDoNotTrack === "1") {
      window['ga-disable-{{ site.google_analytics }}'] = true;
      return;
    }

    // Load GA after a short delay to prioritize page content
    setTimeout(function() {
      var script = document.createElement('script');
      script.src = 'https://www.googletagmanager.com/gtag/js?id={{ site.google_analytics }}';
      script.async = true;
      document.head.appendChild(script);

      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      window.gtag = gtag;
      gtag('js', new Date());
      gtag('config', '{{ site.google_analytics }}');
    }, 2000);
  });
</script>
